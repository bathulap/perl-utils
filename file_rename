#!/usr/bin/perl
use strict;
use warnings;
use File::Copy;

# Configuration
my $trigger_file = 'trigger.txt';   # Path to the trigger file
my $directory = '.';                # Directory containing the AFP files

# Read the trigger file
open my $fh, '<', $trigger_file or die "Cannot open $trigger_file: $!";
my $trigger = <$fh>;
chomp $trigger;
close $fh;

# Check the trigger value
if ($trigger eq 'rename') {
    # Open the directory
    opendir my $dir, $directory or die "Cannot open directory: $!";

    # Iterate over files in the directory
    while (my $file = readdir($dir)) {
        # Process only .AFP files
        next unless $file =~ /\.AFP$/i;

        # Check if the file matches the pattern *_S70_*
        if ($file =~ /^(.*)_S70_(.*)\.AFP$/i) {
            my $file_path = "$directory/$file";

            # Check if the file size is greater than 0 KB
            if (-s $file_path > 0) {
                my $new_file = $1 . '_S80_' . $2 . '.AFP';

                # Rename the file
                move($file_path, "$directory/$new_file") or die "Failed to rename $file to $new_file: $!";
                print "Renamed $file to $new_file\n";
            } else {
                print "File $file is empty. No renaming done.\n";
            }
        }
    }

    closedir($dir);
} else {
    print "No renaming required according to the trigger file.\n";
}
